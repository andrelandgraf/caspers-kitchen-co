# Caspers Kitchen

A Next.js food ordering application with AI-powered chat assistant.

## Local Development Setup

### Prerequisites

- [Bun](https://bun.sh/) (v1.0+)
- [Vercel CLI](https://vercel.com/cli)
- A PostgreSQL database (via [Neon](https://neon.com/))

### 1. Fork

Fork the repository to your own GitHub account.

### 2. Clone and Install

Clone the repository to your local machine.

```bash
git clone <repo-url>
cd caspers-kitchen-co
bun install
```

### 2. Create a Vercel project

Create a new Vercel project and link it to the repository.

### 3. Create a Blob storage

Create a new Blob storage on Verceland link it to the repository. Either use the Vercel CLI or the Vercel dashboard.

### 4. Create a Neon database

Create a new Neon database - easiest to do via the Vercel dashboard's Storage tab. Or use neon.com and create a new database. After, copy the connection string and add it to the Vercel environment variables.

```bash
DATABASE_URL="postgresql://user:password@host/database?sslmode=require"
```

### 2. Set Up Environment Variables

Create a `.env.development` file in the project root.

Next, authenticate with Vercel and link the project to the repository.

```bash
vercel login
vercel link
```

Then pull the environment variables from the Vercel project.

```bash
vercel env pull .env.development
```

This should include the Vercel OIDC token for the AI Gateway, the Blob storage token, and the Neon database connection string.

Also create a `.env.local` file in the project root.

```bash
BETTER_AUTH_URL="http://localhost:3000"
```

The `.env.development` can be overridden by the `.env.local` file for local development variables such as the base URL.

### 5. Set Up Email (optional - emails will be skipped if not configured)

Sign up for Resend and create a new API key. Then add the API key to the Vercel environment variables.

```bash
RESEND_API_KEY="re_xxx"
RESEND_FROM_EMAIL="Caspers Kitchen <noreply@casperskitchenco.com>"
```

### 6. Run Database Migrations

```bash
bun run db:migrate
```

### 7. Seed the Database with Menu Items

```bash
bun run db:seed:food
```

### 8. Start Development Server

```bash
bun dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

## Environment Variables Reference

| Variable                      | Required     | Description                                                                 |
| ----------------------------- | ------------ | --------------------------------------------------------------------------- |
| `AI_GATEWAY_API_KEY`          | One of these | Vercel AI Gateway API key                                                   |
| `VERCEL_OIDC_TOKEN`           | One of these | Auto-generated by `vercel env pull`                                         |
| `BETTER_AUTH_SECRET`          | Yes          | Random secret for auth sessions                                             |
| `BETTER_AUTH_URL`             | Yes          | Base URL (`http://localhost:3000` for dev)                                  |
| `DATABASE_URL`                | Yes          | PostgreSQL connection string                                                |
| `BLOB_READ_WRITE_TOKEN`       | Yes          | Vercel Blob storage token                                                   |
| `RESEND_API_KEY`              | No           | Resend API key for transactional emails                                     |
| `RESEND_FROM_EMAIL`           | No           | Sender email (defaults to `Caspers Kitchen <noreply@casperskitchenco.com>`) |
| `DATABRICKS_WORKSPACE_URL`    | No           | Databricks workspace URL for analytics                                      |
| `DATABRICKS_CLIENT_ID`        | No           | Databricks service principal client ID                                      |
| `DATABRICKS_CLIENT_SECRET`    | No           | Databricks service principal client secret                                  |
| `DATABRICKS_ZEROBUS_ENDPOINT` | No           | ZeroBus endpoint URL                                                        |
| `DATABRICKS_ZEROBUS_TABLE`    | No           | Target table for events (e.g., `catalog.schema.table`)                      |

## Analytics (Optional)

The app can stream events (cart actions, orders) to Databricks via ZeroBus for analytics.

### Setup

1. **Create the events table** in Databricks by running the SQL in `scripts/db/create-databricks-table.sql`

2. **Create a service principal** in Databricks with write access to the events table

3. **Add environment variables**:

```bash
DATABRICKS_WORKSPACE_URL="https://your-workspace.cloud.databricks.com/"
DATABRICKS_CLIENT_ID="your-service-principal-client-id"
DATABRICKS_CLIENT_SECRET="your-service-principal-secret"
DATABRICKS_ZEROBUS_ENDPOINT="https://workspace-id.zerobus.region.cloud.databricks.com"
DATABRICKS_ZEROBUS_TABLE="catalog.schema.events"
```

4. **Build the native SDK** (macOS only - pre-built binaries available for Linux/Windows):

```bash
cd node_modules/@databricks/zerobus-ingest-sdk
bun install && bun run build
```

If Databricks is not configured, events are silently skipped.

## Scripts

```bash
bun dev              # Start development server
bun build            # Build for production
bun start            # Start production server
bun typecheck        # Run TypeScript type checking
bun test             # Run all tests
bun test:unit        # Run unit tests
bun test:acceptance  # Run Playwright acceptance tests
bun run db:migrate   # Run database migrations
bun run db:seed:food # Seed database with menu items
bun run db:studio    # Open Drizzle Studio
```

## Tech Stack

- **Framework**: Next.js 15 (App Router)
- **Runtime**: Bun
- **Database**: PostgreSQL (Neon) with Drizzle ORM
- **Auth**: Better Auth
- **AI**: Vercel AI SDK with AI Gateway
- **Styling**: Tailwind CSS v4 + shadcn/ui
- **Email**: Resend

## Deploy on Vercel

The easiest way to deploy is via [Vercel](https://vercel.com/new):

1. Push to GitHub
2. Import project in Vercel
3. Configure environment variables
4. Deploy

See [Next.js deployment docs](https://nextjs.org/docs/app/building-your-application/deploying) for details.
